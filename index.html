<!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <meta name="viewport" content="width=device-width, initial-scale=1.0">    <title>Mini P.E.K.K.A.'s Pancake Clicker</title>    <!-- Load Tailwind CSS -->    <script src="https://cdn.tailwindcss.com"></script>    <style>        /* Custom styles for Clash Royale/Pekka theme */        body {            font-family: 'Inter', sans-serif;            background-color: #0d1117; /* Dark background */            min-height: 100vh;        }
        .pekka-button {            transition: transform 0.05s ease-out, box-shadow 0.1s ease-out;            cursor: pointer;            user-select: none;            /* --- PANCAKE STYLES --- */            border: 4px solid #cc8e35; /* Brown crust border */            /* Radial gradient for the cooked pancake surface */            background: radial-gradient(circle at 50% 50%, #FFD700 0%, #FFA500 60%, #8B4513 100%);             /* Shadow using brown/orange hues to match food theme */            box-shadow: 0 10px 20px rgba(139, 69, 19, 0.7), inset 0 0 15px rgba(255, 240, 200, 0.5);         }
        .pekka-button:active {            transform: scale(0.98);            box-shadow: 0 5px 10px rgba(139, 69, 19, 0.9), inset 0 0 5px rgba(255, 240, 200, 0.6);        }                /* Ensure click value text is readable against the pancake */        .pekka-button .text-yellow-300 {            color: #4B2A0F; /* Dark brown text for high contrast */            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);        }
        .upgrade-card {            background-color: #1a202c; /* Dark card background */            border-left: 5px solid #7e22ce; /* Purple accent */            transition: transform 0.1s;        }
        .upgrade-card:hover {            transform: translateY(-2px);            box-shadow: 0 8px 15px rgba(126, 34, 206, 0.3);        }
        .upgrade-card:disabled {            opacity: 0.6;            cursor: not-allowed;            transform: none;        }
        .text-epic-purple {            color: #7e22ce;        }                .purchase-button {            background-image: linear-gradient(to right, #4c1d95, #7c3aed);            transition: all 0.2s;        }
        .purchase-button:hover:not(:disabled) {            background-image: linear-gradient(to right, #7c3aed, #a78bfa);            box-shadow: 0 4px 10px rgba(126, 34, 206, 0.5);        }
        .leaderboard-item:nth-child(1) { color: #FFD700; font-weight: bold; } /* Gold */        .leaderboard-item:nth-child(2) { color: #C0C0C0; } /* Silver */        .leaderboard-item:nth-child(3) { color: #CD7F32; } /* Bronze */

        /* Responsive font scaling for the clicker */        @media (max-width: 640px) {            .pekka-text {                font-size: 8rem; /* Large size for mobile touch target */            }            .score-text {                font-size: 3.5rem;            }        }        @media (min-width: 641px) {            .pekka-text {                font-size: 10rem;            }            .score-text {                font-size: 4.5rem;            }        }                /* Modal Styles */        .modal-overlay {            /* Using a high Z-index to ensure it sits above the main content */            background-color: rgba(0, 0, 0, 0.85);             transition: opacity 0.3s ease;            z-index: 99;         }        /* Clicker Pop-up Style (Ensures it appears over the button) */        .click-popup {            z-index: 60;            position: absolute;            transition: transform 0.5s ease-out, opacity 0.5s ease-out;            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);        }    </style></head><body class="text-white">    <div class="max-w-4xl mx-auto p-4 flex flex-col items-center relative">        <!-- Firebase Status -->        <div id="auth-status" class="w-full text-center text-sm text-gray-500 mb-2">            Loading game data...        </div>
        <!-- Shop Button -->        <button id="shop-button" onclick="toggleShopModal(true)"                 class="absolute top-4 right-4 z-50 bg-purple-700 hover:bg-purple-600 text-white font-bold py-2 px-4 rounded-lg shadow-lg transition-colors flex items-center">            <span class="text-xl mr-2"> </span> Shop        </button>
        <!-- Title and Scoreboard -->        <header class="w-full text-center mb-6">            <h1 class="text-5xl font-extrabold text-yellow-400 mt-4 mb-2">Mini P.E.K.K.A.'s Kitchen</h1>            <p class="text-lg text-gray-400 mb-4">Time to make some sweet Pancakes!</p>            <div id="score-display" class="bg-gray-800 p-4 rounded-xl shadow-lg border-2 border-purple-500">                <div class="score-text font-mono tracking-widest leading-none mb-2">                    <span id="pancakes-count">0.00</span>                 </div>                 <div class="text-3xl font-mono tracking-widest leading-none mb-2 text-cyan-400">                    <span id="gems-count">0</span>                 </div>                <div class="text-sm text-yellow-300 font-semibold mt-1">                    (<span id="pps-count">0.0</span> PPS)                </div>            </div>        </header>
        <!-- Main Clicker Area -->        <div class="mb-8 w-full flex justify-center">            <!-- Removed bg-purple-900 class since the background is now set by the .pekka-button CSS -->            <button id="pekka-clicker" class="pekka-button w-4/5 max-w-xs aspect-square rounded-full flex flex-col items-center justify-center p-4">                <span class="pekka-text leading-none transition-all duration-75 ease-out">                                    </span>                <!-- Text color is now modified in the CSS for contrast against the pancake -->                <span class="text-xl font-bold text-yellow-300 -mt-4">+<span id="click-value-display">1</span> </span>            </button>        </div>                <!-- --- SHOP MODAL --- -->        <div id="shop-modal" class="hidden fixed inset-0 modal-overlay flex items-center justify-center p-4">            <div class="bg-gray-900 w-full max-w-xl max-h-[90vh] rounded-xl shadow-2xl p-6 overflow-y-auto border-2 border-purple-600">                <div class="flex justify-between items-center mb-4">                    <h2 class="text-3xl font-bold text-epic-purple">The Troop Kitchen</h2>                    <button onclick="toggleShopModal(false)" class="text-gray-400 hover:text-white text-2xl font-bold">                        &times;                    </button>                </div>                                <div id="shop" class="w-full grid grid-cols-1 gap-4">                                        <!-- Upgrade Card: Buy Gem -->                    <div class="upgrade-card p-4 rounded-lg flex justify-between items-center" id="buyGem-card">                        <div>                            <span class="text-3xl mr-3 text-cyan-400"> </span>                            <span class="text-xl font-semibold">Buy Gem</span>                            <p class="text-gray-400 text-sm">Convert Pancakes into Gems to climb the Gem Leaderboard! (1 Gem)</p>                        </div>                        <button class="purchase-button text-sm font-bold py-2 px-4 rounded-full" onclick="buyGem()" id="buy-gem">                            Buy (<span id="gem-cost-display">10K</span> )                        </button>                    </div>
                    <!-- Upgrade Card 4: Mega Knight Multiplier -->                    <div class="upgrade-card p-4 rounded-lg flex justify-between items-center" id="megaKnight-card">                        <div>                            <span class="text-3xl mr-3 text-red-500"> </span>                            <span class="text-xl font-semibold">Mega Knight Drop</span>                            <p class="text-gray-400 text-sm">Jumps down and multiplies ALL earnings (PPS & Click) by x5! (One-time)</p>                            <p class="text-sm text-yellow-500">Active: <span id="megaKnight-count">No</span></p>                        </div>                        <button class="purchase-button text-sm font-bold py-2 px-4 rounded-full" onclick="buyTroop('megaKnight')" id="buy-megaKnight">                            Buy (100K )                        </button>                    </div>
                    <!-- Upgrade Card 5: Auto Clicker -->                    <div class="upgrade-card p-4 rounded-lg flex justify-between items-center" id="autoclicker-card">                        <div>                            <span class="text-3xl mr-3 text-blue-400"> </span>                            <span class="text-xl font-semibold">Premium AFK Clicker</span>                            <p class="text-gray-400 text-sm">Simulates one manual click per second while you're away. (One-time)</p>                        </div>                        <button class="purchase-button text-sm font-bold py-2 px-4 rounded-full" onclick="buyAutoClicker()" id="buy-autoclicker">                            Buy (39.9K )                        </button>                    </div>
                    <!-- Standard Troop Upgrades -->                    <div class="upgrade-card p-4 rounded-lg flex justify-between items-center" data-troop="goblin">                        <div>                            <span class="text-3xl mr-3"> </span>                            <span class="text-xl font-semibold">Goblin Rush</span>                            <p class="text-gray-400 text-sm">A quick stab of flavor. (+0.2 PPS)</p>                            <p class="text-sm text-yellow-500">Owned: <span class="troop-count" id="goblin-count">0</span></p>                        </div>                        <button class="purchase-button text-sm font-bold py-2 px-4 rounded-full" onclick="buyTroop('goblin')" id="buy-goblin">                            Buy (<span class="troop-cost" id="goblin-cost">10</span> )                        </button>                    </div>
                    <div class="upgrade-card p-4 rounded-lg flex justify-between items-center" data-troop="wizard">                        <div>                            <span class="text-3xl mr-3"> </span>                            <span class="text-xl font-semibold">Fireball Fry</span>                            <p class="text-gray-400 text-sm">Magic cooking power! (+2.0 PPS)</p>                            <p class="text-sm text-yellow-500">Owned: <span class="troop-count" id="wizard-count">0</span></p>                        </div>                        <button class="purchase-button text-sm font-bold py-2 px-4 rounded-full" onclick="buyTroop('wizard')" id="buy-wizard">                            Buy (<span class="troop-cost" id="wizard-cost">100</span> )                        </button>                    </div>
                    <div class="upgrade-card p-4 rounded-lg flex justify-between items-center" data-troop="pekka">                        <div>                            <span class="text-3xl mr-3"> </span>                            <span class="text-xl font-semibold">P.E.K.K.A. Master Chef</span>                            <p class="text-gray-400 text-sm">Now that's a lot of butter! (+20.0 PPS)</p>                            <p class="text-sm text-yellow-500">Owned: <span class="troop-count" id="pekka-count">0</span></p>                        </div>                        <button class="purchase-button text-sm font-bold py-2 px-4 rounded-full" onclick="buyTroop('pekka')" id="buy-pekka">                            Buy (<span class="troop-cost" id="pekka-cost">1000</span> )                        </button>                    </div>                </div>            </div>        </div>        <!-- --- END SHOP MODAL --- -->
        <!-- The '---' line is purely visual and does not affect the code. -->        ---                <!-- Leaderboard Section -->        <h2 class="text-3xl font-bold text-yellow-400 mt-8 mb-4 border-b-2 border-yellow-600 pb-2 w-full text-center">Global Leaderboards</h2>        <div class="w-full grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">                        <!-- Pancake Leaderboard -->            <div class="bg-gray-800 p-4 rounded-xl shadow-lg border-2 border-yellow-500">                <h3 class="text-xl font-bold text-yellow-400 mb-3 text-center">Top 10 Pancakes </h3>                <ol id="pancake-leaderboard" class="space-y-2 text-lg">                    <!-- Leaderboard items will be inserted here by JS -->                    <li class="text-gray-400">Loading...</li>                </ol>            </div>
            <!-- Gem Leaderboard -->            <div class="bg-gray-800 p-4 rounded-xl shadow-lg border-2 border-cyan-400">                <h3 class="text-xl font-bold text-cyan-400 mb-3 text-center">Top 10 Gems </h3>                <ol id="gem-leaderboard" class="space-y-2 text-lg">                    <!-- Leaderboard items will be inserted here by JS -->                    <li class="text-gray-400">Loading...</li>                </ol>            </div>
        </div>                <!-- Reset Button and Info -->        <footer class="mt-8 w-full text-center">            <button id="reset-button" class="text-red-400 hover:text-red-500 text-sm p-2 rounded-lg transition-colors border border-red-400 hover:border-red-500" onclick="resetGame()">                RESET GAME (DANGER!)            </button>            <div id="message-box" class="mt-4 p-3 bg-red-800 text-red-100 rounded-lg hidden"></div>        </footer>    </div>
    <script type="module">        // --- FIREBASE IMPORTS ---        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, setPersistence, browserLocalPersistence, getRedirectResult } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";        import { getFirestore, doc, getDoc, setDoc, onSnapshot, collection, query, limit, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";                // setLogLevel('debug'); // Uncomment for debugging Firestore                // --- FIREBASE GLOBAL VARS ---        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');        // FIX: Corrected variable name from '__initialAuthToken' to '__initial_auth_token'        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;                 let app, db, auth, currentUserId = null;        let authReady = false;
        // --- GAME STATE & INITIALIZATION ---
        let gameState = {            pancakes: 0,            gems: 0,            baseClickValue: 1,            clickValue: 1,            pps: 0,            autoClickerActive: false,            megaKnightMultiplier: 1,            username: `MiniCooker_${Math.floor(Math.random() * 9000) + 1000}`, // Simple default username            troops: {                goblin: { count: 0, baseCost: 10, costMultiplier: 1.15, ppsPerUnit: 0.2 },                wizard: { count: 0, baseCost: 100, costMultiplier: 1.25, ppsPerUnit: 2.0 },                pekka: { count: 0, baseCost: 1000, costMultiplier: 1.35, ppsPerUnit: 20.0 }            },            // Special one-time upgrade costs            megaKnightCost: 100000,            autoClickerCost: 39900,            gemCost: 10000        };
        // DOM Elements        const $pancakesCount = document.getElementById('pancakes-count');        const $gemsCount = document.getElementById('gems-count');        const $ppsCount = document.getElementById('pps-count');        const $clickValueDisplay = document.getElementById('click-value-display');        const $pekkaClicker = document.getElementById('pekka-clicker');        const $messageBox = document.getElementById('message-box');        const $authStatus
